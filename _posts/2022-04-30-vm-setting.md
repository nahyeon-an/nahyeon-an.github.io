---
layout: post
title: "[Linux] Virtual Box 사용하면서 배우는 지식들"  
date: 2022-04-30 04:24 +0000
categories: linux
tags: [linux, install, network]
toc:  true
---

<br>
<br>

## 들어가며...
<hr>
나는 하둡 클러스터, kuberenetes 클러스터를 구성할 때, Virtual Box 를 이용하여 실험을 종종 진행한다.  
일단, vm을 초기화하는 과정에서, 알게된 linux 지식들을 정리하려고 한다.  

<br>
<br>

## 가상머신 이란?  
<hr>  

### VM
컴퓨팅 환경/시스템(게스트)을 컴퓨팅 환경(호스트)에서 에뮬레이션 하기 위한 소프트웨어  
- 왜 사용할까?  
- 호스트 os 와 고립된 다른 os, 게스트 os 를 구성하여 앱을 개발하거나 테스트해보기 위해서  
- 호스트 환경에서 수행하기 위험한 작업을 테스트하기 위해서도 사용함 
  - VM 은 sandbox 로써, vm 내의 sw 가 호스트에 영향을 줄 수 없음  
물리적 컴퓨터와 동일한 기능을 제공하는 sw 컴퓨터  

종류  
1. 시스템 가상 머신  
   1. 하드웨어 가상 머신
   2. 호스트 물리 컴퓨터를 다중화 (multiplex)
   3. 가상화를 제공하는 소프트웨어 계층을 하이퍼바이저라고 함
      1. 하이퍼바이저는 호스트 os 위에서 실행
   4. 호스트 컴퓨터의 물리적 리소스를 가상 머신 사이에 공유 가능함  
2. 프로세스 가상 머신  
   1. 대표적으로 JVM   
   2. 플랫폼에 독립적으로 프로그램을 실행하는 것  
   3. 호스트 hw, os 정보를 감춤

<br>

### 서버 가상화  
서버 사용자로부터 서버의 리소스를 숨기는 기술  
sw 를 통해 물리적 서버를 고유한 가상 서버로 분리하는 것  
- 각 가상 서버는 자체 os 를 독립적으로 실행  

세 가지 유형이 존재하는데,,,,
1. 완전 가상화  
   1. 물리 서버의 리소스와 직접 통신하는 하이퍼바이저라는 sw 를 사용  
   2. 하이퍼바이저는 물리 서버의 리소스를 모니터링하여 가상 서버를 독립적으로 유지  
   3. 하이퍼바이저는 물리 서버의 리소스를 가상 서버에 적절히 할당함  
   4. 게스트 os 가 물리서버 os와 동일할 필요가 없음  
2. 반가상화
3. os 수준 가상화  
   1. 하이퍼바이저 사용 X
   2. 물리 서버의 os 가 제공하는 가상화 기능을 사용하는 것  
   3. 해당 물리 서버에 생성되는 가상 서버는 동일한 os 로 실행됨  

<br>
<br>

## DHCP
<hr>

Dynamic Host Configuration Protocol  
호스트의 ip 와 tcp/ip 프로토콜의 기본 설정을 클라이언트에게 자동으로 제공해주는 프로토콜  
네트워크에 사용되는 ip 주소를 dhcp 서버가 중앙집중적으로 관리하는 서버/클라이언트 모델  
dhcp 클라이언트는 네트워크 부팅과정에서 dhcp 서버에 ip 주소 요청을 하여 얻음  
- ip 주소, 네임 서버 주소, 게이트웨이 주소 등을 할당해줌

<br>
<br>

## 네트워크 어댑터  
<hr>

고정 ip 를 할당하기 위해 centos vm 의 네트워크 설정 파일을 다음과 같이 수정한다.  

맥 os 에서 네트워크 설정 시, NAT 어댑터와 호스트 전용 어댑터 모두 설정한 뒤, centos 설치해야 함  
- 네트워크 설정 문제로 yum repo mirror server 접근 불가함  

[Virtual box 네트워크 어댑터에 관한 내용](https://cjwoov.tistory.com/11)  


<br>
<br>

## IP 주소 192.168.0.1 이란?   
<hr>
인터넷에 연결된 모든 장치는 IP 주소를 가짐.  
- 공개 ip, 개인 ip 모두 가진다   
- 192.168.0.1 는 사설 IP 주소로, 다양한 라우터 모델의 기본값임  

<br>

### 공용 IP vs. 개인 IP  
공용 IP: ISP (인터넷 서비스 공급자)가 사용자에게 할당하는 주소  
- 인터넷에서 고유한 주소임  

사설 IP : 라우터가 가지는, 사설망에서만 허용되는 주소  
- 외부에서 직접 액세스 하는 주소가 아님 -> 전 세계적으로 고유할 필요가 없음 -> 192.168.0.1   
- 개인 네트워크 외부의 192.168.0.1 주소에 액세스 할 수 없음  
- 사설 IP가 직접 인터넷에 액세스도 불가능함  
- ISP를 통해 연결해야 함  

즉, 우리가 다른 망에 연결한다고 생각해보자  
양 끝에는 라우터가 있다고 가정  
인터넷에 연결하는 경로/과정은 다음과 같음  
- 나의 컴퓨터 -> 라우터 -> ISP -> 인터넷 -> 수신자 ISP -> 수신자 라우터 -> 수신자  

집에서 와이파이 공유기를 설정할 때, http://192.168.0.1 로 접속함  
- 라우터의 기본 사설 ip   
- 해당 주소로 접속해서 네트워크 라우터 관리 콘솔을 이용할 수 있음  

<br>
<br>

## /etc/hosts  
<hr>

브라우저에 도메인 입력 -> 네임서버 -> ip 주소로 변환  
localhost 를 입력하면 네임서버를 거칠까?  

레드헷/우분투 계열은 /etc/hosts 파일을 먼저 확인하여, 도메인을 ip 주소로 변환함    

브라우저, 터미널에서 도메인 입력 -> 네임서버 -> ip 로 변환  
- 과거에 네임서버가 없었을 때?  
- 각자 ip 접근, 매핑 테이블 관리  
- 그때 관리하던 양식이 hosts.txt  

호스트 컴퓨터가 네임서버에 접근할 수 없을 때, 도메인으로 접근이 필요하다면?
- /etc/hosts 를 이용 
- 즉, "도메인 이름과 ip 주소의 매핑 파일"임  
- network 데몬을 재실행하여, 다시 메모리에 로드해야 변경된 매핑 테이블이 읽힘  

<br>
<br>

## /etc/profile, /etc/bashrc
<hr>
리눅스를 사용하면서 환경 설정을 위해 종종 profile, bashrc 등의 파일을 수정한다.  
그러나 이 파일들 사이의 차이에 대해서 잘 몰랐기 때문에, 이참에 조사해서 정리한다.  

profile
- 유닉스에서 로그인을 위한 환경설정을 저장하는 용도  
- /etc/profile : 모든 계정에 공통 적용  
- $HOME/.profile : 로그인 계정에서 사용하는 환경설정  

즉, root로 로그인 -> 먼저 /etc/profile 을 읽어서 환경 적용 -> $HOME/.profile 을 읽어서 환경 적용  

/etc/profile.d 디렉터리의 모든 쉘스크립트를 실행시키는 코드
```shell
for i in /etc/profile.d/*.sh /etc/profile.d/sh.local ; do
    if [ -r "$i" ]; then
        if [ "${-#*i}" != "$-" ]; then
            . "$i"
        else
            . "$i" >/dev/null
        fi
    fi
done
```
즉, /etc/profile.d 안의 각종 설정이 최초 로그인 시 적용됨  

bashrc  
- profile 과 비슷하게, /etc/bashrc 는 모든 계정이 사용하는 설정이고, $HOME/.bashrc 는 로그인 계정이 사용하는 설정이다.  
- .bashrc 파일에서 /etc/bashrc 를 호출함  

즉, bash 쉘을 사용할 때, /etc/profile -> $HOME/.profile -> $HOME/.bashrc -> /etc/bashrc 순으로 호출  

profile 과 bashrc 각각에 어떤 내용을 설정하면 좋을까?
- profile : system wide environment  
- bashrc : system wide runctions, aliases                 

rc 는 run command 의 줄임말이라고 함          
로그인하는 쉘의 종류에 맞게 {shell name}rc 파일을 설정한다  

<br>
<br>

## visudo
<hr>

리눅스에는 관리자 계정과 일반 계정이 존재함  
- 일반 계정에서 sudo 명령어를 통해 임시적으로 root 권한을 획득 가능  
- 관리자 계정에서 일반 계정에 sudo 권한을 주어야, 일반 계정에서 root 권한을 사용가능  

sudo 권한은 /etc/sudoers 파일에서 관리된다  
- 직접 수정할 수 있지만 visudo 를 통해 수정할 것을 권장함  

```shell
$ visudo
# 아래와 같은 부분에서 권한 추가 가능  
root         ALL=(ALL)       ALL
hadoop       ALL=(ALL)       ALL

# sudo 사용 시 패스워드 입력을 제거하는 부분
root         ALL=(ALL)       NOPASSWD: ALL
```

<br>
<br>

## 방화벽  
<hr>

<br>
<br>

## 글을 마치며...
<hr>
오늘은 vm 에 개인 학습용 하둡/k8s 클러스터를 설치하는 과정에서 보게된 설정이나, 명령어에 대해 정리해봤다.  
- 가상머신과 가상화  
- dhcp, ip, 사설 ip  
- 설정 파일간의 차이  

등의 내용을 찾아봤다.  
또 VM을 사용하며 찾아보게 되는 내용들을 간단히 추가하려고 한다.  

<br>
<br>
<br>